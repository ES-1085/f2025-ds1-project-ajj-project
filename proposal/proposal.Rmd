---
title: "Project proposal"
author: "AJJ: Armin, Jiwon, Jamari"
output: github_document
---

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(readxl)
library(dplyr)
library(ggplot2)
library(ggrepel)
```

## 1. Introduction

The data for our group project is sourced from the OECD, specifically from two datasets: “Annual Real GDP Growth - OECD and Non-OECD Countries” and “Annual GDP and Consumption Per Capita - OECD and Non-OECD Countries.”
The first dataset provides annual GDP growth figures for OECD member states and selected non-member countries covering the years 2018-2024, while the second dataset reports GDP and consumption per capita over the same period. Together, these datasets allow us to analyze how different nations recovered economically following the severe disruptions of the COVID-19 pandemic. The selected time frame enables us to trace economic trajectories before, during, and after the pandemic, helping us understand both the immediate impact and the long-term recovery patterns.

After data cleaning, our combined dataset contains fewer than 500 data points, with x observations and x variables. We excluded large economic blocs such as the EU or G7 to focus exclusively on national-level performance and to avoid potential data overlap. For our analysis, we will focus on four countries: the United States, Denmark, South Africa, and India. Two of these nations are OECD members, while the other two are not. This is a deliberate choice to highlight contrasts between advanced and emerging economies. 

Moreover, we plan to add a few additional variables to our dataset by categorizing the levels of economic recovery into performance groups. These categories may include classifications such as stagnating, recovering, and booming. This transformation will allow us to better visualize and compare how selected countries performed during the post-Covid recovery period, providing clearer insights into the relative strength and pace of their economic rebounds.

For this project, our research focuses on the varying levels of economic recovery around the world following the COVID-19 pandemic. We aim to closely examine the observations in our datasets to identify potential patterns (such as geographic or regional trends) that reveal which countries recovered quickly and which continued to face significant challenges. 
Some of the questions we hope to explore include: 

* Are there identifiable geographic patterns indicating which countries were more effective in rebounding economically? 
* How much did the average year-on-year GDP growth rates vary across countries and regions, and were there any notable outliers?
* What factors might explain why some countries recovered more successfully than others? We plan to compare and analyze selected countries. 
* How can we meaningfully categorize countries into groups such as stagnating, recovering, and booming, and what does the global distribution of these categories reveal about overall recovery trends?
* Among our four selected economies, which performed best, and what key drivers contributed to their relative success?


## 2. Data

```{r load-data, message = FALSE}
GDP_Data <- read_excel("/cloud/project/data/Annual_GDP_Growth_OECD_and_non_OECD.xlsx")
# View(GDP_Data)

GDP_Per_Capita <- read_excel("/cloud/project/data/Annual GDP Per Capita OECD and Non-OECD.xlsx.xlsx")
# View(GDP_Per_Capita)
```

```{r dimensions, message = FALSE}
dim(GDP_Data)
dim(GDP_Per_Capita)
```

```{r glimpse, message = FALSE}
glimpse(GDP_Data)
glimpse(GDP_Per_Capita)
```
```{r dataset-names, message = FALSE}
names(GDP_Data)
names(GDP_Per_Capita)
```


## 3. Data analysis plan

The variables we will be visualizing to explore our research question are the following:

* GDP_growth: Core measure of economic recovery; allows comparison across countries and time.
* Quarter: Time-series analysis to see trends over time between 2018 Q2 to 2025 Q2.
* Country: Compare recovery across nations and regions.
* Recovery_category: Helps visualize and compare group-level performance; categorized as “Stagnating,” “Recovering,” “Booming”.
* Continent/region: Explore geographic patterns in recovery

Other additional data we may explore are datasets which will categorize the levels of economic recovery from COVID-19 into performance groups. These categories may include classifications such as stagnating, recovering, and booming. This transformation will allow us to better visualize and compare how different countries performed during the post-Covid recovery period, providing clearer insights into the relative strength and pace of their economic rebounds.

Our goal for the project is to examine the differences in economic recovery across OECD countries from the COVID-19 pandemic. We will observe using quarterly GDP growth data ranging from 2018 Q2 to 2025 Q2. Our view comes from different statistics which categorises countries that experienced the fastest and most sustained economic recoveries. 

We’ll start with exploratory data analysis to help us understand trends and the structure of our dataset. We’ll summarize tendencies, and other important information the dataset provides. Once we understand the dataset, then we’ll begin to visualize and explore the recovery patterns within the time period, while distinguishing geography, and economics.

* GDP_growth: GDP growth is the variable representing the quarterly percentage change. It is the main measure of economic recovery, and allows us to compare within countries and time periods.

* Quarter: The dataset starts in 2018 Q2 to 2025 Q2, which gives us information on GDP before, during, and after the pandemic. Looking at the times before and present day will directly provide us with the recovery time and sustainability.

* Country: We’ll use this variable to compare the economic recoveries across nations. Differences can range due to policies or resource factors that may limit a nation's growth or have it thrive.

* Recovery_category: We’ll classify countries as Stagnating, Recovering, or Booming based on their post pandemic GDP growth averages. This will allow us to visualise and for our group to make an analysis.

* Continent/Region: From this we’ll be able to identify patterns from different regions, and how different regions were affected and able to recover faster/slower.

Exploratory Data Analysis:

We’ll start by cleaning the dataset by removing unnecessary information and converting the dataset to quarterly time.
Then we’ll identify countries with the highest/lowest GDP growth past the pandemic. We can do this by using histograms and boxplots to identify outliers in the dataset.
Lastly, we’ll summarize the dataset. We’ll show who had the strongest recovery post pandemic, and how consistent the patterns were within each region:

```{r clean-column-names, message = FALSE}
names(GDP_Per_Capita)[1] <- "Country"
```

```{r convert-to-long-format-for-time-series-analysis, message = FALSE, warning = FALSE}
# make all column names characters  
names(GDP_Data) <-
  as.character(names(GDP_Data))

# convert all "year" columns (2018–2024) to characters before pivoting
GDP_Data <-
  GDP_Data %>%
  mutate(across(matches("^20"), as.character))

# pivot longer using the original "Time Period" column  
gdp_growth_long <- GDP_Data %>%
  pivot_longer(
    cols = matches("^20"),       # selects 2018–2024 columns
    names_to = "Year",
    values_to = "GDP_Growth"
  ) %>%
  mutate(
    Year = as.integer(Year),     # turn "2018" → 2018
     GDP_Growth = as.numeric(GDP_Growth),
    Country = `Time period`
  ) %>%
  select(-`Time period`)

gdp_growth_long <- gdp_growth_long %>%
  filter(Country != "Country")

GDP_Per_Capita <- GDP_Per_Capita %>%
  filter(str_trim(Country) != "Country") %>%
  select(-2)

glimpse(gdp_growth_long)
```

```{r summary-statistics, message = FALSE}
summary_stats <- gdp_growth_long %>%
  group_by(Year) %>%
  summarize(
    mean_growth = mean(GDP_Growth, na.rm = TRUE),
    median_growth = median(GDP_Growth, na.rm = TRUE),
    sd_growth = sd(GDP_Growth, na.rm = TRUE),
    min_growth = min(GDP_Growth, na.rm = TRUE),
    max_growth = max(GDP_Growth, na.rm = TRUE),
    .groups = "drop"
  )

print(summary_stats)
```

```{r identify-countries-post-pandemic (2021-24), message = FALSE}
post_pandemic_growth <- gdp_growth_long %>%
  filter(Year >= 2021) %>%
  group_by(`Country`) %>%
  summarize(avg_growth_post_pandemic = mean(GDP_Growth, na.rm = TRUE)) %>%
  arrange(desc(avg_growth_post_pandemic))

```

```{r clean-non-OECD-country-name, message = FALSE}
gdp_growth_long <- gdp_growth_long %>%
  mutate(`Country` = str_replace(`Country`, pattern = "·  ", replacement = ""))

```


Planned Data Visualization:
- Line Plots: to represent the time periods 
- Box Plots: to separate data between regions 
- Bar Charts: to compare the average GDP growth by each country
- Scatter Plot: to represent the recovery time vs. GDP growth

```{r growth-over-time, message = FALSE}
# Filter for your four focus countries
focus_countries <- c("United States", "Denmark", "South Africa", "India")

(plot1_gdp_trends <- gdp_growth_long %>%
  filter(`Country` %in% focus_countries) %>%
  ggplot(aes(x = Year, y = GDP_Growth, color = `Country`, group = `Country`)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(
    title = "GDP Growth Trends (2018–2024)",
    subtitle = "Tracking Pre-, During-, and Post-COVID Economic Growth",
    x = "Year",
    y = "GDP Growth (%)",
    color = "Country",
    caption = "Source: OECD Data (Annual Real GDP Growth, 2018–2024)"
  ) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "bottom") + 
  scale_color_viridis_d() +
    ylim(-10, NA) +
    annotate("text", x = 2020, y = -7, label = "COVID Outbreak", color = "black", size = 4, vjust = 1.5))

ggsave("plot1_gdp_trends.png", plot = plot1_gdp_trends, width = 7, height = 5)
plot1_gdp_trends
```

```{r avg-post-pandemic-growth, message = FALSE}
post_pandemic_growth <- gdp_growth_long %>%
  filter(Year >= 2021) %>%
  group_by(`Country`) %>%
  summarize(avg_growth_post_pandemic = mean(GDP_Growth, na.rm = TRUE)) %>%
  arrange(desc(avg_growth_post_pandemic))

plot2_post_pandemic <- post_pandemic_growth %>%
  slice_max(avg_growth_post_pandemic, n = 15) %>%
  ggplot(aes(x = reorder(`Country`, avg_growth_post_pandemic), y = avg_growth_post_pandemic)) +
  geom_col(fill = "#0072B2") +
  coord_flip() +
  labs(
    title = "Top 15 Countries by GDP Growth (2021–2024)",
    subtitle = "Post-COVID Economic Recovery Strength",
    x = "Country",
    y = "GDP Growth (%)",
  ) +
  theme_minimal(base_size = 13)

ggsave("plot2_post_pandemic.png", plot = plot2_post_pandemic, width = 7, height = 5)
plot2_post_pandemic
```

```{r growth-distribution-by-recovery, message = FALSE}
# Step 1: Categorize countries based on post-pandemic average growth
gdp_growth_long_cat <- gdp_growth_long %>%
  filter(Year >= 2021) %>%
  group_by(`Country`) %>%
  mutate(
    avg_growth = mean(GDP_Growth, na.rm = TRUE),
    Recovery_Category = case_when(
      avg_growth <= 0 ~ "Stagnating",
      avg_growth > 0 & avg_growth <= 3 ~ "Recovering",
      avg_growth > 3 ~ "Booming",
      TRUE ~ NA_character_
    )
  ) %>%
  ungroup()

# Step 2: Remove any rows with NA in Recovery_Category
gdp_growth_long_cat <- gdp_growth_long_cat %>%
  filter(!is.na(Recovery_Category))

# Step 3: Create box plot
plot3_box <- gdp_growth_long_cat %>%
  ggplot(aes(x = Recovery_Category, y = GDP_Growth, fill = Recovery_Category)) +
  geom_boxplot(alpha = 0.8, outlier.color = "gray30") +
  labs(
    title = "GDP Growth Distribution by Recovery Category (2021–2024)",
    subtitle = "Excluding countries with missing or incomplete GDP growth data",
    x = "Recovery Category",
    y = "GDP Growth (%)",
    ) +
  scale_fill_manual(values = c(
    "Stagnating" = "#E74C3C",
    "Recovering" = "#F1C40F",
    "Booming" = "#2ECC71"
  )) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_fill_viridis_d()

# Step 4: Save and display plot
ggsave("plot3_box.png", plot = plot3_box, width = 5, height = 4)
plot3_box
```

```{r plot4-gganimate, warning=FALSE}
region_map <- tibble(
  Country = unique(GDP_Data$`Time period`),
  Region = case_when(
    Country %in% c("United States", "Canada", "Mexico") ~ "North America",
    Country %in% c("Denmark", "France", "Germany", "United Kingdom", "Italy", "Spain") ~ "Europe",
    Country %in% c("Türkiye") ~ "Middle East",
    Country %in% c("South Africa") ~ "Africa",
    TRUE ~ "Other"
  )
)

gdp_region <- GDP_Data %>%
  pivot_longer(cols = matches("^20"), names_to="Year", values_to="GDP_Growth") %>%
  mutate(
    Year = as.integer(Year),
    GDP_Growth = as.numeric(GDP_Growth),
    Country = `Time period`
  ) %>%
  left_join(region_map, by="Country")

focus_countries <- c("United States", "Denmark", "Türkiye", "South Africa")

focus_colors <- c(
  "United States" = "#1f77b4",
  "Denmark" = "#2ca02c",
  "Türkiye" = "#d62728",
  "South Africa" = "#9467bd"
)

plot_region_covid <- gdp_region %>%
  ggplot(aes(x = Year, y = GDP_Growth, group = Country)) +

  # COVID shading bar (2020)
  annotate("rect", xmin = 2020 - 0.5, xmax = 2020 + 0.5,
           ymin = -Inf, ymax = Inf, fill = "red", alpha = 0.12) +
  
  # Grey background countries
  geom_line(
    data = gdp_region %>% filter(!Country %in% focus_countries),
    aes(color = Region),
    alpha = 0.3,
    linewidth = 0.8
  ) +
  
  # Highlighted countries
  geom_line(
    data = gdp_region %>% filter(Country %in% focus_countries),
    aes(color = Country),
    linewidth = 1.4
  ) +
  geom_point(
    data = gdp_region %>% filter(Country %in% focus_countries),
    aes(color = Country),
    size = 2
  ) +
  geom_text_repel(
    data = gdp_region %>% filter(Country %in% focus_countries),
    aes(label = Country, color = Country),
    size = 4,
    show.legend = FALSE
  ) +
  
  scale_color_manual(values = c(focus_colors,
                                "Europe" = "darkblue",
                                "North America" = "darkgreen",
                                "Africa" = "orange",
                                "Middle East" = "purple",
                                "Other" = "grey50")) +

  labs(
    title = "GDP Growth with Regional Filtering & COVID Highlight",
    subtitle = "COVID year (2020) shaded in red | Highlighted Countries Emphasized",
    x = "Year",
    y = "GDP Growth (%)",
    color = "Region / Country"
  ) +
  
  theme_minimal(base_size = 14) +
  theme(legend.position = "bottom") +

  transition_reveal(Year)

animate(
  plot_region_covid,
  fps = 12,
  duration = 8,
  renderer = gifski_renderer(),
  width = 900,
  height = 550
)

```


