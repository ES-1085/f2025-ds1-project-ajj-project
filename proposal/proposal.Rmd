---
title: "Project proposal"
author: "AJJ: Armin, Jiwon, Jamari"
output: github_document
---

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(readxl)
library(dplyr)
library(ggplot2)
library(ggrepel)
library(gganimate)  
library(scales)  
library(geomtextpath) # Provides geom_textpath
```

```{r extra-packages-to-load, message=FALSE}
# install.packages("gifski")
# install.packages("png")
# install.packages(c("ggplot2", "gganimate", "geomtextpath", "dplyr"))
```


## 1. Introduction

The data for our group project is sourced from the OECD, specifically from two sources: “Annual Real GDP Growth - OECD and Non-OECD Countries” and “Annual GDP and Consumption Per Capita - OECD and Non-OECD Countries.”
The first dataset provides annual GDP growth figures for OECD member states and selected non-member countries covering the years 2018-2024, while the second dataset reports GDP and consumption per capita over the same period. Together, these datasets allow us to analyze how different nations recovered economically following the severe disruptions of the COVID-19 pandemic. The selected time frame enables us to trace economic trajectories before, during, and after the pandemic, helping us understand both the immediate impact and the long-term recovery patterns.

After data cleaning, our datasets contained fewer than 750 combined data points, with 46 observations and 8 variables in each initial dataset, before further changes were made down the line. We excluded large economic blocs such as the EU or G7 to focus exclusively on national-level performance and to avoid potential data overlap. For our analysis, we will focus primarily on four countries: the United States, Denmark, South Africa, and India. Two of these nations are OECD members, while the other two are not. This is a deliberate choice to highlight contrasts between advanced and emerging economies. 

Moreover, we plan to add a few additional variables to our dataset by categorizing the levels of economic recovery into performance groups. These categories may include classifications such as recovering and booming. This transformation will allow us to better visualize and compare how selected countries performed during the post-Covid recovery period, providing clearer insights into the relative strength and pace of their economic rebounds.

For this project, our research focuses on the varying levels of economic recovery around the world following the COVID-19 pandemic. We aim to closely examine the observations in our datasets to identify potential patterns (such as geographic or regional trends) that reveal which countries recovered quickly and which continued to face significant challenges. 
Some of the questions we hope to explore include: 

* Are there identifiable geographic patterns indicating which countries were more effective in rebounding economically? 
* How much did the average year-on-year GDP growth rates vary across countries and regions, and were there any notable outliers?
* What factors might explain why some countries recovered more successfully than others? We plan to compare and analyze selected countries. 
* How can we meaningfully categorize countries into groups such as recovering and booming, and what does the global distribution of these categories reveal about overall recovery trends?
* Among our four selected economies, which performed best, and what key drivers contributed to their relative success?


## 2. Data

```{r load-data, message = FALSE}
GDP_Data <- read_excel("/cloud/project/data/Annual_GDP_Growth_OECD_and_non_OECD.xlsx")
# View(GDP_Data)

GDP_Per_Capita <- read_excel("/cloud/project/data/Annual GDP Per Capita OECD and Non-OECD.xlsx.xlsx")
# View(GDP_Per_Capita)
```

```{r dimensions, message = FALSE}
dim(GDP_Data)
dim(GDP_Per_Capita)
```

```{r glimpse, message = FALSE}
glimpse(GDP_Data)
glimpse(GDP_Per_Capita)
```

```{r dataset-names, message = FALSE}
names(GDP_Data)
names(GDP_Per_Capita)
```


## 3. Data analysis plan

The variables we will be visualizing to explore our research question are the following:

* GDP_growth: Core measure of economic recovery; allows comparison across countries and time.
* GDP_Per_Capita: Core measure of economic recovery per person within a geographich region; allows comparison across countries and time.
* Timeline: Time-series analysis to see trends over time between 2018 to 2024.
* Country: Compare recovery across nations and regions.
* Recovery_category: Helps visualize and compare group-level performance; categorized as  “Recovering” and “Booming”.
* Continent/region: Explore geographic patterns in recovery

Other additional data we may explore are datasets which will categorize the levels of economic recovery from COVID-19 into performance groups. These categories may include classifications such as recovering and booming. This transformation will allow us to better visualize and compare how different countries performed during the post-Covid recovery period, providing clearer insights into the relative strength and pace of their economic rebounds.

Our goal for the project is to examine the differences in economic recovery across OECD countries from the COVID-19 pandemic. We will observe using GDP growth data ranging from 2018 to 2024, as well as measuring GDP Per Capita data during the same time period. Our view comes from different statistics which categorize countries that experienced the fastest and most sustained economic recoveries. 

We’ll start with exploratory data analysis to help us understand trends and the structure of our dataset. We’ll summarize tendencies, and other important information the dataset provides. Once we understand the dataset, then we’ll begin to visualize and explore the recovery patterns within the time period, while distinguishing geography, and economics.

* GDP_growth: GDP growth is the variable representing the annual percentage change. It is the main measure of economic recovery, and allows us to compare within countries and time periods.

* GDP_Per_Capita: GDP Per Capita is the variable representing the annual GDP percentage change per individual in a geographic region. It is one of the main measures of economic recovery, and allows us to compare within countries and time periods. It provides a similar, yet slightly different metric to just GDP growth by additionally exploring how citizens' wealth grew over the selected time period.

* Timeline: The dataset starts in 2018 to 2024, which gives us information on GDP before, during, and after the pandemic. Looking at the times before and present day will directly provide us with the recovery time and sustainability.

* Country: We’ll use this variable to compare the economic recoveries across nations. Differences can range due to policies or resource factors that may limit a nation's growth or have it thrive.

* Recovery_category: We’ll classify countries as Recovering or Booming based on their post pandemic GDP growth averages. This will allow us to visualise and for our group to make an analysis.

* Continent/Region: From this we’ll be able to identify patterns from different regions, and how different regions were affected and able to recover faster/slower.

Exploratory Data Analysis:

We’ll start by cleaning the dataset by removing unnecessary information and converting the dataset to quarterly time.
Then we’ll identify countries with the highest/lowest GDP growth past the pandemic. We can do this by using histograms and boxplots to identify outliers in the dataset.
Lastly, we’ll summarize the dataset. We’ll show who had the strongest recovery post pandemic, and how consistent the patterns were within each region:

```{r clean-column-names, message = FALSE}
names(GDP_Per_Capita)[1] <- "Country"
```

```{r convert-to-long-format-for-time-series-analysis, message = FALSE, warning = FALSE}
# make all column names characters  
names(GDP_Data) <-
  as.character(names(GDP_Data))

# convert all "year" columns (2018–2024) to characters before pivoting
GDP_Data <-
  GDP_Data %>%
  mutate(across(matches("^20"), as.character))

# pivot longer using the original "Time Period" column  
gdp_growth_long <- GDP_Data %>%
  pivot_longer(
    cols = matches("^20"),       # selects 2018–2024 columns
    names_to = "Year",
    values_to = "GDP_Growth"
  ) %>%
  mutate(
    Year = as.integer(Year),     # turn "2018" → 2018
     GDP_Growth = as.numeric(GDP_Growth),
    Country = `Time period`
  ) %>%
  select(-`Time period`)

gdp_growth_long <- gdp_growth_long %>%
  filter(Country != "Country")

GDP_Per_Capita <- GDP_Per_Capita %>%
  filter(str_trim(Country) != "Country") %>%
  select(-2)

glimpse(gdp_growth_long)
```

```{r summary-statistics, message = FALSE}
summary_stats <- gdp_growth_long %>%
  group_by(Year) %>%
  summarize(
    mean_growth = mean(GDP_Growth, na.rm = TRUE),
    median_growth = median(GDP_Growth, na.rm = TRUE),
    sd_growth = sd(GDP_Growth, na.rm = TRUE),
    min_growth = min(GDP_Growth, na.rm = TRUE),
    max_growth = max(GDP_Growth, na.rm = TRUE),
    .groups = "drop"
  )

print(summary_stats)
```

```{r identify-countries-post-pandemic (2021-24), message = FALSE}
post_pandemic_growth <- gdp_growth_long %>%
  filter(Year >= 2021) %>%
  group_by(`Country`) %>%
  summarize(avg_growth_post_pandemic = mean(GDP_Growth, na.rm = TRUE)) %>%
  arrange(desc(avg_growth_post_pandemic))

```

```{r clean-non-OECD-country-name, message = FALSE}
gdp_growth_long <- gdp_growth_long %>%
  mutate(`Country` = str_replace(`Country`, pattern = "·  ", replacement = ""))

```


Planned Data Visualization:
- Line Plots: to represent the time periods 
- Box Plots: to separate data between regions 
- Bar Charts: to compare the average GDP growth by each country
- Scatter Plot: to represent the recovery time vs. GDP growth

# Plot1: GDP Growth Trends Over Time by Country

```{r growth-over-time, message = FALSE, fig.alt = "Line chart showing GDP growth for Denmark, India, South Africa, and the United States from 2018-2024. All countries have positive growth before 2020, fall sharply in 2020, then recover in 2021. India rebounds the most, nearing 10%, while the others return to low positive growth through 2024."}

# Filter for your four focus countries
focus_countries <- c("United States", "Denmark", "South Africa", "India")

plot1_gdp_trends <- gdp_growth_long %>%
  filter(`Country` %in% focus_countries) %>%
  ggplot(aes(x = Year, y = GDP_Growth, color = `Country`, group = `Country`)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(
    title = "GDP Growth Trends (2018–2024)",
    subtitle = "Tracking Pre-, During-, and Post-COVID Economic Growth",
    x = "Year",
    y = "GDP Growth (%)",
    color = "Country",
    caption = "Source: OECD Data (Annual Real GDP Growth, 2018–2024)"
  ) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "bottom") + 
  scale_color_viridis_d() +
    ylim(-10, NA) +
    annotate("text", x = 2020, y = -7, label = "COVID Outbreak", color = "black", size = 4, vjust = 1.5)

ggsave("plot1_gdp_trends.png", plot = plot1_gdp_trends, width = 7, height = 5)
plot1_gdp_trends
```

# Plot 2: Average GDP Growth by Category

```{r avg-post-pandemic-growth, message = FALSE, fig.alt = "Bar chart showing the top 15 countries by average GDP growth from 2021 to 2024. Bars run horizontally with countries on the y-axis and GDP growth on the x-axis. India has the highest average growth at about 8%, followed by Türkiye, Ireland, and China near 6%, with the remaining countries showing growth between roughly 4% and 5%."}
post_pandemic_growth <- gdp_growth_long %>%
  filter(Year >= 2021) %>%
  group_by(`Country`) %>%
  summarize(avg_growth_post_pandemic = mean(GDP_Growth, na.rm = TRUE)) %>%
  arrange(desc(avg_growth_post_pandemic))

plot2_post_pandemic <- post_pandemic_growth %>%
  slice_max(avg_growth_post_pandemic, n = 15) %>%
  ggplot(aes(x = reorder(`Country`, avg_growth_post_pandemic), y = avg_growth_post_pandemic)) +
  geom_col(fill = "#0072B2") +
  coord_flip() +
  labs(
    title = "Top 15 Countries by GDP Growth (2021–2024)",
    subtitle = "Post-COVID Economic Recovery Strength",
    x = "Country",
    y = "GDP Growth (%)",
  ) +
  theme_minimal(base_size = 13)

ggsave("plot2_post_pandemic.png", plot = plot2_post_pandemic, width = 7, height = 5)
plot2_post_pandemic
```
# Plot 3: GDP Growth Distribution by Recovery Category (2021-2024)

```{r growth-distribution-by-recovery, message = FALSE, fig.alt = "Box plot comparing GDP growth distribution for two recovery categories from 2021 to 2024. The x-axis shows “Booming” and “Recovering,” and the y-axis shows GDP growth in percent. The “Booming” group has higher median growth and a wider range of values, including an upper outlier, while the “Recovering” group shows lower median growth and a narrower spread."}
# Step 1: Categorize countries based on post-pandemic average growth
gdp_growth_long_cat <- gdp_growth_long %>%
  filter(Year >= 2021) %>%
  group_by(`Country`) %>%
  mutate(
    avg_growth = mean(GDP_Growth, na.rm = TRUE),
    Recovery_Category = case_when(
      avg_growth > 0 & avg_growth <= 3 ~ "Recovering",
      avg_growth > 3 ~ "Booming",
      TRUE ~ NA_character_
    )
  ) %>%
  ungroup()

# Step 2: Remove any rows with NA in Recovery_Category
gdp_growth_long_cat <- gdp_growth_long_cat %>%
  filter(!is.na(Recovery_Category))

# Step 3: Create box plot
plot3_box <- gdp_growth_long_cat %>%
  ggplot(aes(x = Recovery_Category, y = GDP_Growth, fill = Recovery_Category)) +
  geom_boxplot(alpha = 0.8, outlier.color = "gray30") +
  labs(
    title = "GDP Growth Distribution by Recovery Category (2021–2024)",
    subtitle = "Excluding countries with missing or incomplete GDP growth data",
    x = "Recovery Category",
    y = "GDP Growth (%)",
    ) +
  scale_fill_manual(values = c(
    "Recovering" = "#F1C40F",
    "Booming" = "#2ECC71"
  )) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_fill_viridis_d()

# Step 4: Save and display plot
ggsave("plot3_box.png", plot = plot3_box, width = 5, height = 4)
plot3_box
```
# Plot 4: GDP Growth Animation  

```{r plot4-gganimate, warning = FALSE, eval = FALSE, fig.alt = "Animated line chart showing annual GDP growth from 2018 to 2024 for all countries in the dataset, with individual country lines shown in light grey and four highlighted countries shown in color. A red-shaded band marks the year 2020. The animation reveals each year sequentially. India shows the strongest recovery after 2020, rising the highest among the highlighted countries, while the United States, Denmark, and South Africa show more moderate growth paths."}

# Highlight countries
focus_countries <- c("United States", "Denmark", "India", "South Africa")
gdp_region <- gdp_region %>%
  mutate(Highlight = ifelse(Country %in% focus_countries, "Focus", "Other"))

focus_colors <- c(
  "United States" = "#0072B2",
  "Denmark"       = "#009E73",
  "India"         = "#D55E00",
  "South Africa"  = "#CC79A7"
)

# Plot with COVID shading and labels that stick to one side
plot_region_covid <- gdp_region %>%
  ggplot(aes(x = Year, y = GDP_Growth, group = Country)) +

  # COVID shading
  annotate("rect",
           xmin = 2019.5, xmax = 2020.5,
           ymin = -Inf, ymax = Inf,
           fill = "red", alpha = 0.1) +

  # Other countries
  geom_line(
    data = gdp_region %>% filter(Highlight == "Other"),
    aes(color = Region),
    alpha = 0.3,
    linewidth = 0.7
  ) +

  # Highlighted countries
  geom_line(
    data = gdp_region %>% filter(Highlight == "Focus"),
    aes(color = Country),
    linewidth = 2
  ) +

  geom_point(
    data = gdp_region %>% filter(Highlight == "Focus"),
    aes(color = Country),
    size = 2.5
  ) +

  # Labels that follow the lines but stick to the right side
  geom_text_repel(
    data = gdp_region %>% filter(Highlight == "Focus"),
    aes(label = Country, color = Country),
    nudge_x = 0.2,        # shift all labels to the right
    direction = "y",       # only allow movement vertically
    hjust = 0,             # left-align text
    segment.color = NA,    # remove connector lines
    size = 5,
    show.legend = FALSE,
    force = 0.1            # reduces jitter so labels don't jump
  ) +

  scale_color_manual(
    values = c(
      "North America"="darkgreen",
      "Europe"="darkblue",
      "Africa"="orange",
      "Southeast Asia"="purple",
      "Other"="grey70",
      focus_colors
    )
  ) +

  labs(
    title = "GDP Growth by Region (2018–2024)",
    subtitle = "COVID-19 recession in 2020 is highlighted",
    x = "Year",
    y = "GDP Growth (%)",
    color = "Region / Highlighted Countries"
  ) +
  theme_minimal(base_size = 16) +
  theme(legend.position = "bottom") +
  transition_reveal(Year)

# Animate
animate(
  plot_region_covid,
  fps = 9,
  duration = 10,
  width = 750,
  height = 500,
  renderer = gifski_renderer()
)
```


# Plot 5: GDP per Capita vs. Average Post-COVID GDP Growth

```{r plot5-scatterplot-Per-Capita-vs-Growth, message = FALSE, fig.alt = "Scatterplot comparing average GDP per capita vs. annual GDP growth for 46 countries between 2021 and 2024. Each country is shown as a point, colored by OECD membership. OECD members are mostly clustered toward the right side of the plot with higher GDP per capita and weaker growth rates. Non OECD countries have lower GDP per capita and tend to appear on the left side of the plot with stronger growth rates. India and South Africa are labeled in blue and sit among the non OECD group. The United States and Denmark are labeled in orange within the OECD group. A downward sloping trendline shows that higher income countries experienced slower growth on average. Annotations mark the areas of lower income faster growth and higher income slower growth."}

# Clean and average GDP per capita, 2021-2024

gdp_pc_avg <- GDP_Per_Capita |>
  mutate(Country = trimws(Country)) |>
  mutate(across(`2021`:`2024`, as.numeric)) |>
  select(Country, `2021`:`2024`) |>
  pivot_longer(
    cols      = `2021`:`2024`,
    names_to  = "Year",
    values_to = "gdp_pc"
  ) |>
  group_by(Country) |>
  summarise(
    avg_gdp_pc = mean(gdp_pc, na.rm = TRUE),
    .groups = "drop"
  )

# Average GDP growth per country

gdp_growth_avg <- gdp_growth_long_cat |>
  mutate(Country = trimws(Country)) |>
  select(Country, avg_growth) |>
  distinct()

# Join growth + income

growth_vs_income <- gdp_growth_avg |>
  inner_join(gdp_pc_avg, by = "Country") |>
  filter(!is.na(avg_gdp_pc), !is.na(avg_growth))

# OECD Membership and focus countries

oecd_countries <- c(
  "Australia","Austria","Belgium","Canada","Chile","Colombia","Costa Rica",
  "Czechia","Denmark","Estonia","Finland","France","Germany","Greece",
  "Hungary","Iceland","Ireland","Israel","Italy","Japan","Korea",
  "Latvia","Lithuania","Luxembourg","Mexico","Netherlands","New Zealand",
  "Norway","Poland","Portugal","Slovak Republic","Slovenia","Spain",
  "Sweden","Switzerland","Türkiye","United Kingdom","United States"
)

focus_countries <- c("India", "United States", "Denmark", "South Africa")

growth_vs_income <- growth_vs_income |>
  mutate(
    OECD  = if_else(Country %in% oecd_countries,
                    "OECD member", "Non-OECD"),
    Focus = Country %in% focus_countries
  )

# Scatterplot

growth_income_plot <- ggplot(growth_vs_income,
                             aes(x = avg_gdp_pc, y = avg_growth)) +
  geom_smooth(method = "lm", se = FALSE, color = "darkgrey", linewidth = 0.7) +
  geom_point(aes(color = OECD), size = 2.5, alpha = 0.8) +
  geom_point(
    data = subset(growth_vs_income, Focus),
    aes(color = OECD),
    size = 3.2
  ) +

 # labels and pointers for focus countries
  geom_text_repel(
    data = subset(growth_vs_income, Focus & Country %in% c("India", "United States", "Denmark", "South Africa")),
    aes(label = Country),
    size = 3.5,
    color = "black",
    box.padding = 0.3,
    max.overlaps = 20,
    show.legend = FALSE
  ) +
  geom_segment(
  data = subset(growth_vs_income, Country == "United States"),
  aes(x = avg_gdp_pc, y = avg_growth,
      xend = avg_gdp_pc + 4000, yend = avg_growth + 0.12),
  linewidth = 0.3, color = "black"
) +
  geom_segment(
  data = subset(growth_vs_income, Country == "Denmark"),
  aes(x = avg_gdp_pc, y = avg_growth,
      xend = avg_gdp_pc + 4000, yend = avg_growth - 0.12),
  linewidth = 0.3, color = "black"
) +
  geom_segment(
  data = subset(growth_vs_income, Country == "India"),
  aes(x = avg_gdp_pc, y = avg_growth,
      xend = avg_gdp_pc + 4000, yend = avg_growth + 0.12),
  linewidth = 0.3, color = "black"
) +
  geom_segment(
  data = subset(growth_vs_income, Country == "South Africa"),
  aes(x = avg_gdp_pc, y = avg_growth,
      xend = avg_gdp_pc + 4000, yend = avg_growth - 0.12),
  linewidth = 0.3, color = "black"
) +

  # quadrant annotations
  annotate(
    "text",
    x = 25000, y = 7.8,
    label = "Lower-income,\nfaster growth",
    hjust = 0, vjust = 1,
    size = 3.5,
    color = "black"
  ) +
  annotate(
    "text",
    x = 140000, y = 2.6,
    label = "Higher-income,\nslower growth",
    hjust = 1, vjust = 0,
    size = 3.5,
    color = "black"
  ) +

  scale_color_manual(
    values = c(
      "OECD member" = "#E69F00",   # orange
      "Non-OECD"    = "#1F78B4"    # blue
    )
  ) +
  scale_x_continuous(labels = comma) +

  labs(
    title    = "GDP per Capita vs. Average GDP Growth 2021-2024",
    subtitle = "Higher-income (mostly OECD) economies grew more slowly after Covid,\nwhile lower-income countries grew faster.",
    x        = "GDP per capita in USD",
    y        = "Annual GDP growth 2021-2024 (%)",
    color    = "OECD status",
    caption  = "Source: OECD Data (GDP per capita and GDP growth, 2021-2024)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major = element_line(color = "grey85"),
    panel.grid.minor = element_blank(),
    legend.position  = "right"
  )

print(growth_income_plot)
```
