---
title: "Project memo"
author: "AJJ"
output: github_document
---

This document should contain a detailed account of the data clean up for your data and the design choices you are making for your plots. For instance you will want to document choices you've made that were intentional for your graphic, e.g. color you've chosen for the plot. Think of this document as a code script someone can follow to reproduce the data cleaning steps and graphics in your handout.

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(gganimate)
library(scales)
library(readxl)
```

## Data Clean Up Steps for Overall Data

### Step 1: Load and Inspect Dataset

```{r load-data, message = FALSE}
GDP_Data <- read_excel("/cloud/project/data/Annual_GDP_Growth_OECD_and_non_OECD.xlsx")
# View(Annual_GDP_Growth_OECD_and_non_OECD)

GDP_Per_Capita <- read_excel("/cloud/project/data/Annual GDP Per Capita OECD and Non-OECD.xlsx.xlsx")
# View(Annual_GDP_Per_Capita_OECD_and_Non_OECD_xlsx)
```

### Step 2: Rename Columns and Pivot Longer

```{r rename-columns-and-pivot, message = FALSE}
gdp_clean <- GDP_Data |>
rename(Country = `Time Period`) |>   # rename for clarity
filter(Country != "Country") |>       # remove header-like cell
pivot_longer(cols = starts_with("20"),
names_to = "Year",
values_to = "GDP_Growth") |>
mutate(Year = as.integer(Year))
```

Description:
The dataset originally had years (2018–2024) as columns, which makes it wide. pivot_longer() converts it into a tidy long format with Year and GDP_Growth columns, making it easier to plot over time.

### Step 3: Categorize Countries by Growth Type

```{r categorize-by-growth, message = FALSE}
gdp_clean <- gdp_clean |>
mutate(Growth_Category = case_when(
GDP_Growth > 4 ~ "Booming",
GDP_Growth > 0 & GDP_Growth <= 4 ~ "Recovering",
GDP_Growth <= 0 ~ "Stagnating"
))
```

Description:
Categorizing helps color/facet plots meaningfully. The thresholds (4% and 0%) are chosen based on typical GDP growth ranges.


## Plots


#### Final Plot 1

```{r final-plot, message = FALSE}

```


### Plot 1: GDP Growth Trends Over Time by Country

#### Data cleanup steps specific to plot 1

Already handled above (pivot + filter + mutate).

```{r growth-over-time, message = FALSE}
# Filter for your four focus countries
focus_countries <- c("United States", "Denmark", "South Africa", "India")

(plot1_gdp_trends <- gdp_growth_long %>%
  filter(`Country` %in% focus_countries) %>%
  ggplot(aes(x = Year, y = GDP_Growth, color = `Country`, group = `Country`)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(
    title = "GDP Growth Trends (2018–2024)",
    subtitle = "Tracking Pre-, During-, and Post-COVID Economic Growth",
    x = "Year",
    y = "GDP Growth (%)",
    color = "Country",
    caption = "Source: OECD Data (Annual Real GDP Growth, 2018–2024)"
  ) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "bottom") + 
  scale_color_viridis_d() +
    ylim(-10, NA) +
    annotate("text", x = 2020, y = -7, label = "COVID Outbreak", color = "black", size = 4, vjust = 1.5))

ggsave("plot1_gdp_trends.png", plot = plot1_gdp_trends, width = 7, height = 5)
plot1_gdp_trends
```

Description:

### Plot 2: Average GDP Growth by Category

```{r avg-post-pandemic-growth, message = FALSE}
post_pandemic_growth <- gdp_growth_long %>%
  filter(Year >= 2021) %>%
  group_by(`Country`) %>%
  summarize(avg_growth_post_pandemic = mean(GDP_Growth, na.rm = TRUE)) %>%
  arrange(desc(avg_growth_post_pandemic))

plot2_post_pandemic <- post_pandemic_growth %>%
  slice_max(avg_growth_post_pandemic, n = 15) %>%
  ggplot(aes(x = reorder(`Country`, avg_growth_post_pandemic), y = avg_growth_post_pandemic)) +
  geom_col(fill = "#0072B2") +
  coord_flip() +
  labs(
    title = "Top 15 Countries by GDP Growth (2021–2024)",
    subtitle = "Post-COVID Economic Recovery Strength",
    x = "Country",
    y = "GDP Growth (%)",
  ) +
  theme_minimal(base_size = 13)

ggsave("plot2_post_pandemic.png", plot = plot2_post_pandemic, width = 7, height = 5)
plot2_post_pandemic
```

Description:


### Plot 3: GDP Growth Distribution by Recovery Category (2021-2024)

```{r growth-distribution-by-recovery, message = FALSE}
# Step 1: Categorize countries based on post-pandemic average growth
gdp_growth_long_cat <- gdp_growth_long %>%
  filter(Year >= 2021) %>%
  group_by(`Country`) %>%
  mutate(
    avg_growth = mean(GDP_Growth, na.rm = TRUE),
    Recovery_Category = case_when(
      avg_growth <= 0 ~ "Stagnating",
      avg_growth > 0 & avg_growth <= 3 ~ "Recovering",
      avg_growth > 3 ~ "Booming",
      TRUE ~ NA_character_
    )
  ) %>%
  ungroup()

# Step 2: Remove any rows with NA in Recovery_Category
gdp_growth_long_cat <- gdp_growth_long_cat %>%
  filter(!is.na(Recovery_Category))

# Step 3: Create box plot
plot3_box <- gdp_growth_long_cat %>%
  ggplot(aes(x = Recovery_Category, y = GDP_Growth, fill = Recovery_Category)) +
  geom_boxplot(alpha = 0.8, outlier.color = "gray30") +
  labs(
    title = "GDP Growth Distribution by Recovery Category (2021–2024)",
    subtitle = "Excluding countries with missing or incomplete GDP growth data",
    x = "Recovery Category",
    y = "GDP Growth (%)",
    ) +
  scale_fill_manual(values = c(
    "Stagnating" = "#E74C3C",
    "Recovering" = "#F1C40F",
    "Booming" = "#2ECC71"
  )) +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none") +
  scale_fill_viridis_d()

# Step 4: Save and display plot
ggsave("plot3_box.png", plot = plot3_box, width = 5, height = 4)
plot3_box
```

Description:

### Plot 4: GDP Growth Animation (Reach Goal)

```{r animated-plot, Message=FALSE}
# 1. Check if gdp_growth_long exists
if (!exists("gdp_growth_long")) {
  stop("ERROR: gdp_growth_long does not exist. 
       This means an earlier chunk failed before creation.")
}

# 2. Check if GDP_Per_Capita exists
if (!exists("GDP_Per_Capita")) {
  stop("ERROR: GDP_Per_Capita does not exist.
       This means the GDP per capita chunk failed.")
}

# 3. Standardize country names
gdp_growth_long_fixed <- gdp_growth_long %>%
  rename(Country = matches("Country|Time period|LOCATION", ignore.case = TRUE)) %>%
  mutate(Country = trimws(Country))

GDP_Per_Capita_fixed <- GDP_Per_Capita %>%
  rename(Country = matches("Country|LOCATION|Country Name", ignore.case = TRUE)) %>%
  mutate(Country = trimws(Country))

# 4. Create merged_data HERE (guaranteed to exist now)
merged_data <- gdp_growth_long_fixed %>%
  left_join(GDP_Per_Capita_fixed, by = c("Country", "Year"))

# Debug print
cat("\nMerged_data columns:\n")
print(names(merged_data))
cat("\nMerged_data rows:", nrow(merged_data), "\n")


merged_data_clean <- merged_data %>%
  filter(!is.na(GDP_Per_Capita),
         GDP_Per_Capita > 0,
         !is.na(GDP_Growth))

plot4_animation <- merged_data_clean %>%
  ggplot(aes(x = GDP_Per_Capita,
             y = GDP_Growth,
             color = Country,
             group = Country)) +
  geom_point(size = 3, alpha = 0.8) +
  scale_x_log10(labels = scales::comma) +
  labs(
    title = "Global Economic Recovery",
    subtitle = "Year: {closest_state}",
    x = "GDP per Capita (log scale)",
    y = "GDP Growth (%)"
  ) +
  theme_minimal() +
  transition_states(Year) +
  enter_fade() +
  exit_shrink()

animate(plot4_animation,
        fps = 10,
        duration = 12,
        width = 800,
        height = 600,
        renderer = gifski_renderer())
```

Description:
This animation shows each country's GDP growth trajectory year by year, inspired by the Gapminder style. It helps visualize shifts in economic momentum dynamically.

